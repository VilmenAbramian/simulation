# pysim - Python Simulator

Набор имитационных моделей на Python.

## Структура пакета

Пакет `pysim` имеет следующую структуру:

```
|-- pysim
|   |-- kernel     код ядра симулятора
|   |-- models     модели
|   |   |-- echo   модель ping-pong'a
|   |   |-- rfid   модель RFID
|   |-- main.py    скрипт команды sim 
```

### Команда `sim`

Команда позволяет получать информацию о моделях и запускать их.

- `sim list`: вывести список моделей
- `sim run <model>`: запустить модель

### Добавление новой модели

Модель - это вложенный пакет в `models`, который отвечает следующим требованиям:

- есть файл `cli.py`;
- в файле `cli.py` есть функция `cli_run(...)`, декорированная как `@click.command` или `@click.group`.

При запуске команда `sim` (то есть скрипт `main.py`) просмотрит все модули в `models`,
импортирует из них `cli.py` и добавит команды `run()` к группе команд `sim run`, а сами модули -
в список моделей.


## Модели

### `pingpong` - Модель пинг-понга

Модель описывает обмен сообщениями `Ping{int}` и `Pong{int}` между двумя
компьютерами по каналу с фиксированной задержкой.

Параметры модели:

- `interval`: интервал между передачами пакетов `Ping`
- `channel_delay`: задержка в канале
- `service_delay`: длительность обслуживания
- `loss_prob`: вероятность потери пакета (`Ping` или `Pong`) в канале
- `max_pings`: максимальное количество отправленных пакетов (`Ping`)
- 
Запуск модели:
Находясь в директории pysim/models/pingpong_oop выполнить команду:
```
python3 cli.py
```
В этом случае модель будет исполнена с параметрами по умолчанию.
Для справки выполнить команду:
```
python3 cli.py --help
```
Тогда появится сообщение:
```
Usage: cli.py [OPTIONS]

  Точка входа модели Ping-Pong. Задать параметры работы.

Options:
  -i, --interval FLOAT        Интервал отправки Ping клиентом (условные
                              единицы)  [default: 10.0]
  -ch, --channel_delay FLOAT  Длительность передачи сообщения (условные
                              единицы)  [default: 2.0]
  -s, --service_delay FLOAT   Длительность обслуживания Ping  [default: 1.0]
  -l, --loss_prob FLOAT       Вероятность потери пакета в канале  [default:
                              0.1]
  -mp, --max_pings INTEGER    Количество отправляемых клиентом Ping-ов
                              [default: 1000000]
  --help                      Show this message and exit.
```

Также есть возможность одновременного запуска сразу нескольких имитационных моделей параллельно, но только для разных значених одного параметра. Пример команды для параллельного запуска:
```
python3 cli.py -i 15 -i 25 -i 35 -i 45 -i 55
```

Вывод результатов:
Результаты выводятся в консоль, например, для команды
```
python3 cli.py -l 0.7  
```
вывод будет выглядеть так:
```
Результаты одиночного моделирования:
Параметры: {'loss_prob': 0.7, 'interval': 10.0, 'channel_delay': 2.0, 'service_delay': 1.0, 'max_pings': 1000000}
- Средний интервал отправки Ping клиентом(условные единицы) = 10.0
- Средняя длительность передачи сообщения(условные единицы) = 2.0
- Вероятность потери сообщения = 0.299611 
```
а для команды 
```
python3 cli.py -i 15 -i 25 -i 35 -i 45 -i 55
```
вот так:
```
Результаты серии численных экспериментов

Таблица параметров:

+---------------+--------------------------------+
|   interval    | (15.0, 25.0, 35.0, 45.0, 55.0) |
| channel_delay |              2.0               |
| service_delay |              1.0               |
|   loss_prob   |              0.1               |
|   max_pings   |            1000000             |
+---------------+--------------------------------+

Таблица результатов:

+--------------+---------------------------------------------------+
| avg_interval |          [15.0, 25.0, 35.0, 45.0, 55.0]           |
|  avg_delay   |             [2.0, 2.0, 2.0, 2.0, 2.0]             |
|  miss_rate   | [0.900109, 0.89992, 0.899941, 0.900157, 0.900191] |
+--------------+---------------------------------------------------+
```
Также если передать функции `result_processing` в модуле `processing.py` параметр
```
save_results=True
```
то результаты моделирования будут сохранены в виде json-строк в директории results.
Пример файла для одной из команд выше
```
Входные параметры: {"interval": [15.0, 25.0, 35.0, 45.0], "channel_delay": 2.0, "service_delay": 1.0, "loss_prob": 0.1, "max_pings": 1000000}
Результаты моделирования: {"avg_interval": [15.0, 25.0, 35.0, 45.0], "avg_delay": [2.0, 2.0, 2.0, 2.0], "miss_rate": [0.900471, 0.89983, 0.900341, 0.900455]}
```

### `rfid` - RFID Simulator

Имитационная модель системы UHF RFID с мобильными считывателями и метками,
полностью реализованная на Python 3.

Модель позволяет:

- вычислять вероятность идентификации метки
- моделировать чтение EPCID и произвольных банков памяти
- моделировать многолучевое распространение
- задавать траектории движения считывателя и меток

Запуск:

```
sim run rfid
```
